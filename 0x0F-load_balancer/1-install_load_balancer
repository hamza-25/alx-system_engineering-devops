#!/usr/bin/env bash
# configure web-02 and update web-01
# sudo apt-get update
# sudo apt-get install haproxy -y

apt-get -y update
apt-get -y upgrade

# Add HAProxy PPA
apt-get -y install software-properties-common
add-apt-repository -y ppa:vbernat/haproxy-2.5
apt-get -y update

# Install HAProxy
apt-get -y install haproxy
cp -a /etc/haproxy/haproxy.cfg{,.orig}

echo "
frontend myfrontend
	bind *:80
	mode http
        default_backend mybackend
backend mybackend
	balance roundrobin
	server 367979-web-01 192.168.1.1:80 check
	server 367979-web-02 192.168.1.2:80 check
" >> /etc/haproxy/haproxy.cfg
sudo service haproxy restart
